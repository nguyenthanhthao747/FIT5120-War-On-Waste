<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>C&D Waste</title>
    {% load static %}
    <!-- Bootstrap core CSS -->
    <link href="{% static 'css/bootstrap.css'%}" rel="stylesheet">

    <!-- Bootstrap core JavaScript -->
    <script src="{% static 'jquery/jquery.min.js'%}"></script>
    <script src="{% static 'js/bootstrap.bundle.js'%}"></script>

    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>

    <!-- Custom fonts for this template -->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700|Raleway:400,700" rel="stylesheet">


    <!-- Custom styles for this template -->
    <link href="{% static 'css/business-casual.min.css'%}" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>



    <style>
        canvas{
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
    </style>

    <style>
      html, body {
        height: 100%;
        margin: 0;
      }
      #map {
        width: 600px;
        height: 400px;
      }
    </style>

  <style>#map { width: 800px; height: 500px; }
  .info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
  .legend { text-align: left; line-height: 18px; color: #555; } .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }</style>
</head>
<body>

<h1 class="site-heading text-center text-white d-none d-lg-block">
    <span class="site-heading-upper text-primary mb-3">Construction and Demolition Waste</span>
    <span class="site-heading-lower">War on Waste</span>
</h1>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark py-lg-4" id="mainNav">
    <div class="container">
        <a class="navbar-brand text-uppercase text-expanded font-weight-bold d-lg-none" href="#">Construction and Demolition Waste</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav mx-auto">
                <li class="nav-item px-lg-4">
                    <a class="nav-link text-uppercase text-expanded" href="{% url 'home'%}">Home</a>
                </li>
                <li class="nav-item active px-lg-4">
                    <a class="nav-link text-uppercase text-expanded" href="{% url 'statistics'%}">Statistics
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item px-lg-4">
                    <a class="nav-link text-uppercase text-expanded" href="{% url 'WasteCalculator'%}">Calculator</a>
                </li>
                <li class="nav-item px-lg-4">
                    <a class="nav-link text-uppercase text-expanded" href="{% url 'SearchLocation'%}">Search</a>
                </li>
                <li class="nav-item px-lg-4">
                    <a class="nav-link text-uppercase text-expanded" href="{% url 'about'%}">About</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<section  class="page-section">
    <div class="container">
        <div class="product-item">
            <div class="product-item-title d-flex">
                <div class="bg-faded p-5 d-flex ml-auto rounded">
                    <h2 class="section-heading mb-0">
                        <span class="section-heading-upper">Melbourne Con Struction Waste</span>
                        <span class="section-heading-lower">2018</span>
                    </h2>
                </div>
            </div>

          <div id='map'></div>

          {% load static %}

          <script type="text/javascript">

            var map = L.map('map').setView(['-37.819505', '144.959863'], 13);

            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidG5ndTAwMTUiLCJhIjoiY2psZDc4emJuMDg5cjNwcDExbXBlMjlwaSJ9._eL7VaMuTYJJzFct2p34Mw', {
              maxZoom: 25,
              attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
              id: 'mapbox.light'
            }).addTo(map);


            // control that shows state info on hover
            var info = L.control();

            info.onAdd = function (map) {
              this._div = L.DomUtil.create('div', 'info');
              this.update();
              return this._div;
            };

            info.update = function (props) {
              this._div.innerHTML = '<h4>Choropleth Map</h4>' +  (props ?
                '<b>' + props.name + '</b><br />' + props.density + ' tones'
                : 'Hover over a suburd');
            };

            info.addTo(map);


            // get color depending on population density value
            function getColor(d) {
              return d > 2500000 ? '#800026' :
                  d > 20000000  ? '#BD0026' :
                  d > 10000000  ? '#E31A1C' :
                  d > 1500000  ? '#FC4E2A' :
                  d > 1000000   ? '#FD8D3C' :
                  d > 150000   ? '#FEB24C' :
                  d > 100000   ? '#FED976' :
                        '#FFEDA0';
            }

            function style(feature) {
              return {
                weight: 2,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.7,
                fillColor: getColor(feature.properties.density)
              };
            }

            function highlightFeature(e) {
              var layer = e.target;

              layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
              });

              if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
              }

              info.update(layer.feature.properties);
            }

            var geojson;

            function resetHighlight(e) {
              geojson.resetStyle(e.target);
              info.update();
            }

            function zoomToFeature(e) {
              map.fitBounds(e.target.getBounds());
            }

            function onEachFeature(feature, layer) {
              layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
              });
            }

          var loaded_data = {};

          // remember to add in year here
          function on_change_load_data(){
            $.ajax({
              url: "./get_json_data/2018/",
              success: function(the_json){
                loaded_data = the_json;

                console.log("thao's loaded data", loaded_data);

                geojson = L.geoJson(loaded_data, {
                  style: style,
                  onEachFeature: onEachFeature
                }).addTo(map);
              }
            });
          }

          // on page load load the data
          on_change_load_data();

            map.attributionControl.addAttribution('Construction waste data &copy; <a href="https://data.melbourne.vic.gov.au/Property-Planning/Major-development-projects-Development-Activity-Mo/gh7s-qda8">Melbourne Construction Waste</a>');

            var legend = L.control({position: 'bottomright'});

            legend.onAdd = function (map) {
              var div = L.DomUtil.create('div', 'info legend'),
                grades = [0, 100000, 150000, 1000000, 1500000, 10000000, 20000000, 2500000],
                labels = [],
                from, to;

              for (var i = 0; i < grades.length; i++) {
                from = grades[i];
                to = grades[i + 1];

                labels.push(
                  '<i style="background:' + getColor(from + 1) + '"></i> ' +
                  from + (to ? '&ndash;' + to : '+'));
              }

              div.innerHTML = labels.join('<br>');
              return div;
            };

            legend.addTo(map);

          </script>

            <div id="mapSection" class="product-item-img mx-auto d-flex rounded img-fluid mb-3 mb-lg-0"></div>
            <div class="product-item-description d-flex mr-auto">
                <div class="bg-faded p-5 rounded">
                    <p class="mb-0">The map illustrates how much Melbourne constructions waste in tones in term of timmbers, bricks, plaster boards, tiles and concretes</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="page-section">
    <div class="container">
        <div class="product-item">
            <div class="product-item-title d-flex">
                <div class="bg-faded p-5 d-flex mr-auto rounded">
                    <h2 class="section-heading mb-0">
                        <span class="section-heading-upper">Line chart for C&D waste</span>
                        <span class="section-heading-lower">Suburb & Year</span>
                    </h2>
                </div>

                <div class="intro-button mx-auto" style="position: absolute; right: 180px; bottom:5px;">
                    <select id="SuburbSelect" class="btn btn-primary btn-xl" >
                        <option value="Southbank">Southbank</option>
                        <option value="Parkville">Parkville</option>
                        <option value="West Melbourne (Industrial)">West Melbourne (Industrial)</option>
                        <option value="Melbourne (CBD)">Melbourne (CBD)</option>
                        <option value="East Melbourne">East Melbourne</option>
                        <option value="West Melbourne (Residential)">West Melbourne (Residential)</option>
                        <option value="North Melbourne">North Melbourne</option>
                        <option value="Port Melbourne">Port Melbourne</option>
                        <option value="Kensington">Kensington</option>
                        <option value="Carlton">Carlton</option>
                        <option value="Docklands">Docklands</option>
                        <option value="Melbourne (Remainder)">Melbourne (Remainder)</option>
                    </select>
                </div>

            </div>

            <div id="graph-container" style="background-color:#e5e3e3;top:48px;" class="product-item-img mx-auto d-flex img-fluid rounded mb-3 mb-lg-0">
                <canvas id="canvas"></canvas>
            </div>

            <br>
            <br>

            <div class="product-item-description d-flex ml-auto" style="top:48px;">
                <div class="bg-faded p-5 rounded">
                    <p class="mb-0">This line show the tonnes of waste for different types of construction materials in each suburb.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<footer class="footer text-faded text-center py-5">
    <div class="container">
        <p class="m-0 small">Copyright &copy; Team Cavaliers 2018</p>
    </div>
</footer>




<!--d3 JavaScript-->
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
<script src="{% static 'js/lineChart.js' %}"></script>

</body>
</html>
